<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Critical initialization: BASE_PATH, cart preload, variant detection -->
  <script src="../scripts/critical-init.js"></script>
  <title>Product Catalog - BuildRight Solutions</title>
  <script src="../scripts/scripts.js" type="module"></script>
  <link rel="stylesheet" href="../styles/styles.css">
  <link rel="stylesheet" href="../blocks/project-filter/project-filter.css">
  <!-- Note: Header CLS prevention now in styles/base.css -->
</head>
<body class="page-catalog">
  <!-- Header loaded dynamically from blocks/header/ -->
  <header></header>

  <!-- Main Content -->
  <main>
    <!-- Breadcrumbs -->
    <div class="breadcrumbs">
      <div>
        <div><a href="../index.html">Home</a></div>
      </div>
      <div>
        <div>Products</div>
      </div>
    </div>

    <section class="section section-compact">
      <div class="container">
        <div class="catalog-layout" id="catalog-layout">
          <!-- Catalog Loading Overlay -->
          <div class="catalog-loading-overlay" id="catalog-loading">
            <div class="loading-spinner loading-spinner-sm"></div>
            <p style="margin-top: var(--spacing-medium); color: var(--color-text-secondary);">Loading catalog...</p>
          </div>
          
          <!-- Filters Sidebar -->
          <aside id="filters-aside" style="visibility: hidden;">
            <div class="filters-sidebar" data-block-name="filters-sidebar" data-block-status="loading">
              <div>
                <div>
                  <div class="filters-header">
                    <h3>Refine Results</h3>
                    <button class="clear-filters" id="clear-filters">Clear All</button>
                  </div>
                  
                  <div class="filter-section">
                    <button class="filter-toggle" data-filter="category" aria-expanded="true">
                      <span>Category</span>
                      <span class="toggle-icon">▼</span>
                    </button>
                    <div class="filter-content active" id="filter-category">
                      <div class="filter-item">
                        <input type="checkbox" id="cat-all" name="category" value="" checked>
                        <label for="cat-all">All Categories</label>
                        <span class="filter-count">(20)</span>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="cat-structural" name="category" value="structural_materials">
                        <label for="cat-structural">Structural Materials</label>
                        <span class="filter-count">(8)</span>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="cat-windows" name="category" value="windows_doors">
                        <label for="cat-windows">Windows & Doors</label>
                        <span class="filter-count">(3)</span>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="cat-fasteners" name="category" value="fasteners_hardware">
                        <label for="cat-fasteners">Fasteners & Hardware</label>
                        <span class="filter-count">(4)</span>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="cat-roofing" name="category" value="roofing">
                        <label for="cat-roofing">Roofing</label>
                        <span class="filter-count">(2)</span>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="cat-framing" name="category" value="framing_drywall">
                        <label for="cat-framing">Framing & Drywall</label>
                        <span class="filter-count">(3)</span>
                      </div>
                    </div>
                  </div>

                  <div class="filter-section">
                    <button class="filter-toggle" data-filter="project" aria-expanded="false">
                      <span>Project Type</span>
                      <span class="toggle-icon">▼</span>
                    </button>
                    <div class="filter-content" id="filter-project">
                      <div class="filter-item">
                        <input type="checkbox" id="proj-all" name="project" value="" checked>
                        <label for="proj-all">All Projects</label>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="proj-new" name="project" value="new_construction">
                        <label for="proj-new">New Construction</label>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="proj-remodel" name="project" value="remodel">
                        <label for="proj-remodel">Remodel</label>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="proj-repair" name="project" value="repair">
                        <label for="proj-repair">Repair</label>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="proj-restore" name="project" value="restoration">
                        <label for="proj-restore">Restoration</label>
                      </div>
                    </div>
                  </div>

                  <div class="filter-section">
                    <button class="filter-toggle" data-filter="price" aria-expanded="false">
                      <span>Price Range</span>
                      <span class="toggle-icon">▼</span>
                    </button>
                    <div class="filter-content" id="filter-price">
                      <div class="price-inputs">
                        <input type="number" id="price-min" placeholder="Min" min="0" step="0.01">
                        <span>to</span>
                        <input type="number" id="price-max" placeholder="Max" min="0" step="0.01">
                      </div>
                      <button class="btn btn-primary btn-sm filter-price-apply">Apply</button>
                    </div>
                  </div>

                  <div class="filter-section">
                    <button class="filter-toggle" data-filter="availability" aria-expanded="false">
                      <span>Availability</span>
                      <span class="toggle-icon">▼</span>
                    </button>
                    <div class="filter-content" id="filter-availability">
                      <div class="filter-item">
                        <input type="checkbox" id="avail-all" name="availability" value="" checked>
                        <label for="avail-all">All Products</label>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="avail-instock" name="availability" value="in_stock">
                        <label for="avail-instock">In Stock</label>
                      </div>
                      <div class="filter-item">
                        <input type="checkbox" id="avail-lowstock" name="availability" value="low_stock">
                        <label for="avail-lowstock">Low Stock</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </aside>

          <!-- Product Grid -->
          <div style="visibility: hidden;" id="product-grid-wrapper">
            <div class="product-grid" data-block-name="product-grid" data-block-status="loading">
              <div>
                <div>
                  <div class="grid-header">
                    <div class="grid-header-controls">
                      <button class="btn btn-secondary btn-sm" id="mobile-filter-toggle">Filters</button>
                      <h2>Products</h2>
                    </div>
                    <div class="product-count" style="visibility: hidden;">0 products</div>
                  </div>
                  <div class="products-container">
                    <!-- Products will be populated by JavaScript -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer loaded dynamically from blocks/footer/ -->
  <footer></footer>

  <script type="module">
    // Mobile filter toggle
    const mobileFilterToggle = document.getElementById('mobile-filter-toggle');
    const filtersAside = document.getElementById('filters-aside');
    
    if (mobileFilterToggle && filtersAside) {
      const checkMobile = () => {
        if (window.innerWidth <= 768) {
          mobileFilterToggle.style.display = 'block';
          filtersAside.style.display = 'none';
        } else {
          mobileFilterToggle.style.display = 'none';
          filtersAside.style.display = 'block';
        }
      };
      
      checkMobile();
      window.addEventListener('resize', checkMobile);
      
      mobileFilterToggle.addEventListener('click', () => {
        filtersAside.style.display = filtersAside.style.display === 'none' ? 'block' : 'none';
      });
    }
  </script>
  
  <script>
    // Handle catalog loading overlay
    (function() {
      const overlay = document.getElementById('catalog-loading');
      const filtersAside = document.getElementById('filters-aside');
      const productGridWrapper = document.getElementById('product-grid-wrapper');
      const productCount = document.querySelector('.product-count');
      
      // Listen for catalog loading event (show spinner, hide content)
      window.addEventListener('catalogLoading', () => {
        if (overlay) {
          overlay.classList.remove('hidden');
        }
        // Hide filters, products, and count during reload
        if (filtersAside) {
          filtersAside.style.visibility = 'hidden';
        }
        if (productGridWrapper) {
          productGridWrapper.style.visibility = 'hidden';
        }
        if (productCount) {
          productCount.style.visibility = 'hidden';
        }
      });
      
      // Listen for catalog loaded event (hide spinner, show content)
      window.addEventListener('catalogLoaded', () => {
        if (overlay) {
          overlay.classList.add('hidden');
        }
        if (filtersAside) {
          filtersAside.style.visibility = 'visible';
        }
        if (productGridWrapper) {
          productGridWrapper.style.visibility = 'visible';
        }
        // Product count visibility is managed by product-grid.js
      });
    })();
  </script>
</body>
</html>
