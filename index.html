<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Load critical data synchronously to prevent layout shift -->
  <script>
    window.__INITIAL_CART_COUNT__ = (() => {
      try {
        const cart = JSON.parse(localStorage.getItem('buildright_cart') || '[]');
        return cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
      } catch (e) {
        return 0;
      }
    })();
    window.__INITIAL_LOCATION__ = localStorage.getItem('buildright_selected_location') || null;
  </script>
  <title>BuildRight Solutions - Building Materials Distributor</title>
  <script src="./scripts/scripts.js" type="module"></script>
  <link rel="stylesheet" href="./styles/styles.css">
  <link rel="stylesheet" href="./styles/blocks/hero-banner.css">
  <link rel="stylesheet" href="./styles/blocks/ideas-center.css">
  <link rel="stylesheet" href="./styles/blocks/shop-by-job.css">
  <!-- Critical CSS for active nav state and comprehensive CLS prevention -->
  <style>
    .nav-link.active, .nav-link[aria-current="page"] {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    /* Comprehensive CLS prevention - reserve space for all dynamic content */
    
    /* Location selector - prevent dropdown menu shift */
    .location-selector {
      min-height: 40px;
      min-width: 280px;
    }
    
    .location-menu {
      position: absolute;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    
    .location-menu.active {
      opacity: 1;
      visibility: visible;
    }
    
    
    /* Product grid */
    .products-container {
      min-height: 300px;
    }
    
    /* Prevent flash of unstyled content */
    [data-loading="true"] {
      opacity: 0.6;
      pointer-events: none;
    }
    
    /* Fragment FOUC prevention */
    body:not(.ready) {
      opacity: 0;
    }
    
    body.ready {
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
    }
  </style>
</head>
<body>
  <!-- Header loaded dynamically from blocks/header/ -->
  <header></header>

  <!-- Hero Section (Fragment Container) -->
  <div class="hero-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
      <div class="skeleton-text"></div>
    </div>
  </div>

  <!-- Features Section (Fragment Container) -->
  <div class="features-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
    </div>
  </div>

  <!-- CTA Section (Fragment Container) -->
  <div class="cta-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
    </div>
  </div>

  <!-- Featured Products - Main Content -->
  <main>
    <section class="section" style="padding: 4rem 0 5rem 0; background: var(--color-surface);">
      <div class="container">
        <div class="flex justify-between items-center mb-4">
          <h2 style="margin: 0; font-size: 1.75rem; font-weight: 700;">Featured Products</h2>
          <a href="catalog" style="color: var(--color-brand-500); text-decoration: none; font-weight: 600; font-size: var(--font-size-base);">View All Products â†’</a>
        </div>
        <div class="products-container featured-products" id="featured-products">
          <!-- Products will be loaded by JavaScript -->
        </div>
      </div>
    </section>

  </main>

  <!-- Footer (Fragment Container) -->
  <div class="footer-fragment"></div>

  <script type="module">
    // Import personalization system
    import { personalizeHomepage } from './scripts/personalize-page.js';
    
    // Personalize page on load
    await personalizeHomepage();
    
    // Load featured products - simplified for EDS data format
    async function loadFeaturedProducts() {
      try {
        const basePath = window.BASE_PATH || '/';
        const response = await fetch(`${basePath}data/mock-products.json`);
        if (!response.ok) {
          console.error('Failed to load products');
          return;
        }
        
        const products = await response.json();
        if (!products || products.length === 0) {
          console.warn('No products loaded');
          return;
        }
        
        const featured = products.slice(0, 4);
        const container = document.getElementById('featured-products');
        
        if (!container) {
          console.warn('Featured products container not found');
          return;
        }
        
        container.innerHTML = '';
        
        for (const product of featured) {
          const price = product.price || 0;
          const imageUrl = product.image || '';
          
          const card = document.createElement('a');
          card.className = 'product-card';
          card.href = `/pages/product-detail.html?sku=${product.sku}`;
          
          // Product image with background
          const image = document.createElement('div');
          image.className = 'product-card-image';
          
          // Only set background image if we have a valid image URL
          if (imageUrl && imageUrl.trim() !== '') {
            image.style.backgroundImage = `url('${imageUrl}')`;
            image.style.backgroundSize = 'cover';
            image.style.backgroundPosition = 'center';
            image.style.backgroundRepeat = 'no-repeat';
          } else {
            // Add placeholder class if no image
            image.classList.add('product-card-image-placeholder');
          }
          card.appendChild(image);
          
          // Header
          const header = document.createElement('div');
          header.className = 'product-card-header';
          const sku = document.createElement('div');
          sku.className = 'product-card-sku';
          sku.textContent = product.sku;
          header.appendChild(sku);
          const name = document.createElement('div');
          name.className = 'product-card-name';
          name.textContent = product.name;
          header.appendChild(name);
          card.appendChild(header);
          
          // Body
          const body = document.createElement('div');
          body.className = 'product-card-body';
          const description = document.createElement('div');
          description.className = 'product-card-description';
          description.textContent = product.description || 'Quality building materials';
          body.appendChild(description);
          card.appendChild(body);
          
          // Footer
          const footer = document.createElement('div');
          footer.className = 'product-card-footer';
          
          const pricing = document.createElement('div');
          pricing.className = 'product-card-pricing';
          const priceEl = document.createElement('span');
          priceEl.className = 'product-card-price';
          priceEl.textContent = `$${price.toFixed(2)}`;
          pricing.appendChild(priceEl);
          const priceLabel = document.createElement('span');
          priceLabel.className = 'product-card-price-label';
          priceLabel.textContent = 'per unit';
          pricing.appendChild(priceLabel);
          footer.appendChild(pricing);
          
          const actions = document.createElement('div');
          actions.className = 'product-card-actions';
          const addBtn = document.createElement('button');
          addBtn.className = 'btn btn-primary btn-sm';
          addBtn.textContent = 'View Details';
          addBtn.onclick = (e) => {
            e.preventDefault();
            e.stopPropagation();
            window.location.href = card.href;
          };
          actions.appendChild(addBtn);
          footer.appendChild(actions);
          
          card.appendChild(footer);
          container.appendChild(card);
        }
      } catch (error) {
        console.error('Error loading featured products:', error);
      }
    }
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadFeaturedProducts);
    } else {
      loadFeaturedProducts();
    }
  </script>
</body>
</html>
