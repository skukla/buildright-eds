<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Load critical data synchronously to prevent layout shift -->
  <script>
    window.__INITIAL_CART_COUNT__ = (() => {
      try {
        const cart = JSON.parse(localStorage.getItem('buildright_cart') || '[]');
        return cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
      } catch (e) {
        return 0;
      }
    })();
    window.__INITIAL_LOCATION__ = localStorage.getItem('buildright_selected_location') || null;
  </script>
  <title>BuildRight Solutions - Building Materials Distributor</title>
  <!-- Note: scripts.js NOT loaded here - this page uses personalization system instead -->
  <link rel="stylesheet" href="./styles/styles.css">
  <!-- Critical CSS for inlined header -->
  <link rel="stylesheet" href="./blocks/header/header.css">
  <link rel="stylesheet" href="./blocks/mini-cart/mini-cart.css">
  <link rel="stylesheet" href="./blocks/user-menu/user-menu.css">
  <link rel="stylesheet" href="./styles/blocks/hero-banner.css">
  <link rel="stylesheet" href="./styles/blocks/ideas-center.css">
  <link rel="stylesheet" href="./styles/blocks/shop-by-job.css">
  <!-- Critical CSS for active nav state and comprehensive CLS prevention -->
  <style>
    .nav-link.active, .nav-link[aria-current="page"] {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    /* Comprehensive CLS prevention - reserve space for all dynamic content */
    
    /* Location selector - prevent dropdown menu shift */
    .location-selector {
      min-height: 40px;
      min-width: 280px;
    }
    
    .location-menu {
      position: absolute;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    
    .location-menu.active {
      opacity: 1;
      visibility: visible;
    }
    
    
    /* Product grid */
    .products-container {
      min-height: 300px;
    }
    
    /* Prevent flash of unstyled content */
    [data-loading="true"] {
      opacity: 0.6;
      pointer-events: none;
    }
    
    /* Fragment FOUC prevention */
    body:not(.ready) {
      opacity: 0;
    }
    
    body.ready {
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
    }
    
    /* Note: Header CLS prevention now in styles/base.css */
  </style>
</head>
<body>
  <!-- Header inlined for instant visibility (Adobe Best Practice: Critical above-the-fold content) -->
  <header>
    <div class="header" data-block-name="header" data-block-status="loading">
      <!-- Top Utility Bar -->
      <div class="header-top">
        <div class="header-top-content">
          <div class="header-location" id="header-location" style="visibility: hidden;">
            <span class="location-label">You're Shopping</span>
            <div class="location-selector-wrapper">
              <button class="location-selector" id="location-selector">
                <span class="location-name">Premium Commercial Builders - Los Angeles, CA</span>
                <span class="location-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg></span>
              </button>
              <div class="location-menu" id="location-menu">
                <div class="location-menu-content">
                  <ul class="location-menu-list" id="location-menu-list">
                    <!-- Locations populated by JavaScript -->
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Header -->
      <div class="header-main">
        <div class="header-main-content">
          <div class="header-brand">
            <a href="index.html">BuildRight</a>
          </div>
          
          <div class="header-search">
            <input type="search" placeholder="Search products, SKUs, or keywords..." class="search-input" id="header-search-input">
            <button class="search-button" aria-label="Search">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                <path d="m21 21-4.34-4.34" />
                <circle cx="11" cy="11" r="8" />
              </svg>
            </button>
          </div>

          <div class="header-actions">
            <div class="user-menu-wrapper">
              <button class="user-link" id="user-menu-toggle" aria-expanded="false" aria-label="User menu">
                <span class="user-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                </span>
                <span class="user-label">Account</span>
              </button>
              <div id="user-menu-container"></div>
            </div>
            <div class="cart-link-wrapper">
              <button class="cart-link" id="cart-link-toggle" aria-expanded="false" aria-label="Shopping cart">
                <span class="cart-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="8" cy="21" r="1"/>
                    <circle cx="19" cy="21" r="1"/>
                    <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
                  </svg>
                </span>
                <span class="cart-label">Cart</span>
                <span class="cart-count"><script>document.write(window.__INITIAL_CART_COUNT__ || 0)</script></span>
              </button>
              <div id="mini-cart-container"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Bar -->
      <div class="header-nav-bar">
        <div class="header-nav-content">
          <button class="menu-toggle" id="menu-toggle" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <nav class="main-nav">
            <div class="nav-item"><a href="pages/catalog.html" class="nav-link" data-category="all">All Products</a></div>
            <div class="nav-item"><a href="pages/project-builder.html" class="nav-link nav-link-cta">Project Builder</a></div>
            <div class="nav-item"><button class="nav-link" data-category="structural_materials">Structural Materials</button></div>
            <div class="nav-item"><button class="nav-link" data-category="windows_doors">Windows & Doors</button></div>
            <div class="nav-item"><button class="nav-link" data-category="fasteners_hardware">Fasteners & Hardware</button></div>
            <div class="nav-item"><button class="nav-link" data-category="roofing">Roofing</button></div>
            <div class="nav-item"><button class="nav-link" data-category="framing_drywall">Framing & Drywall</button></div>
          </nav>
          <div class="nav-industry">
            <button class="industry-toggle" id="industry-toggle" aria-expanded="false">
              Shop By Industry
              <span class="industry-toggle-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Industry Dropdown -->
      <div class="industry-menu" id="industry-menu">
        <div class="industry-menu-content">
          <div class="industry-column">
            <h3>Commercial</h3>
            <ul>
              <li><a href="pages/catalog.html">Commercial Construction</a></li>
              <li><a href="pages/catalog.html">Structural Materials</a></li>
              <li><a href="pages/catalog.html">Windows & Doors</a></li>
            </ul>
          </div>
          <div class="industry-column">
            <h3>Residential</h3>
            <ul>
              <li><a href="pages/catalog.html">Residential Construction</a></li>
              <li><a href="pages/catalog.html">Framing Materials</a></li>
              <li><a href="pages/catalog.html">Residential Windows</a></li>
            </ul>
          </div>
          <div class="industry-column">
            <h3>Pro</h3>
            <ul>
              <li><a href="pages/catalog.html">Trade Contractors</a></li>
              <li><a href="pages/catalog.html">Fasteners & Tools</a></li>
              <li><a href="pages/catalog.html">Roofing Supplies</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section (Fragment Container) -->
  <div class="hero-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
      <div class="skeleton-text"></div>
    </div>
  </div>

  <!-- Features Section (Fragment Container) -->
  <div class="features-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
    </div>
  </div>

  <!-- Featured Products - Main Content -->
  <main>
    <section class="section" style="padding: 4rem 0; background: var(--color-background);">
      <div class="container">
        <h2 class="text-center mb-2" style="font-size: 1.75rem; font-weight: 700;">Featured Products</h2>
        <p class="text-center mb-4" style="color: var(--color-text-secondary); max-width: 600px; margin-left: auto; margin-right: auto; margin-bottom: 2rem;">Explore our most popular building materials and supplies</p>
        
        <!-- Featured Products Block -->
        <div class="featured-products" data-block-name="featured-products" data-block-status="loading">
          <div>
            <div>
              <div class="products-container featured-products">
                <!-- Products will be loaded by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  <!-- CTA Section (Fragment Container) -->
  <div class="cta-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
    </div>
  </div>

    <!-- Featured Categories (Unauthenticated Users Only) -->
    <section class="section unauthenticated-only" style="padding: 4rem 0; background: var(--color-surface);">
      <div class="container">
        <h2 class="text-center mb-4" style="font-size: 1.75rem; font-weight: 700;">Featured Categories</h2>
        <div class="grid grid-3 gap-6">
          <a href="catalog/structural-materials" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/structural.svg" alt="Structural Materials" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Structural Materials</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Lumber, studs, joists, beams</p>
          </a>
          <a href="catalog/windows-doors" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/windows-doors.svg" alt="Windows & Doors" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Windows & Doors</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Residential and commercial</p>
          </a>
          <a href="catalog/fasteners-hardware" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/fasteners.svg" alt="Fasteners & Hardware" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Fasteners & Hardware</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Nails, screws, brackets</p>
          </a>
          <a href="catalog/roofing" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/roofing.svg" alt="Roofing Materials" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Roofing Materials</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Shingles, underlayment, flashing</p>
          </a>
          <a href="catalog/framing-drywall" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/framing-drywall.svg" alt="Framing & Drywall" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Framing & Drywall</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Panels, tape, compound</p>
          </a>
          <a href="catalog" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/catalog.svg" alt="View All Products" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">View All Products</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Browse complete catalog</p>
          </a>
        </div>
      </div>
    </section>

    <!-- Shop By Job (Unauthenticated Users Only) -->
    <section class="section unauthenticated-only" style="padding: 4rem 0; background: var(--color-background);">
      <div class="container">
        <h2 class="text-center mb-4" style="font-size: 1.75rem; font-weight: 700;">Shop By Job</h2>
        <p class="text-center mb-4" style="color: var(--color-text-light); max-width: 600px; margin-left: auto; margin-right: auto;">Get a customized material kit for your specific construction job</p>
        <div class="grid grid-3 gap-6">
          <a href="pages/project-builder.html?type=framing" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Frame a Wall</h3>
              <p class="shop-by-job__text">Complete framing materials for residential wall construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=bathroom" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Remodel a Bathroom</h3>
              <p class="shop-by-job__text">Materials for bathroom renovation and remodeling projects</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=windows" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1509644851169-2acc08aa25b5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Install Windows</h3>
              <p class="shop-by-job__text">Window installation materials and hardware</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=roofing" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1518736346281-76873166a64a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Roof a House</h3>
              <p class="shop-by-job__text">Complete roofing materials for new construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=plumbing" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1607472586893-edb57bdc0e39?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Repair Plumbing</h3>
              <p class="shop-by-job__text">Essential materials for plumbing repairs and maintenance</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=deck" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1656646549607-8fda5837a4ca?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Build a Deck</h3>
              <p class="shop-by-job__text">Lumber, fasteners, and materials for outdoor deck construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer (Fragment Container) -->
  <div class="footer-fragment"></div>

  <script type="module">
    // Import required modules
    import { personalizeHomepage } from './scripts/personalize-page.js';
    import { decorateBlock } from './scripts/scripts.js';
    
    // Initialize the page
    async function initPage() {
      // 1. Personalize page with fragments
      await personalizeHomepage();
      
      // 2. Initialize header interactivity
      const header = document.querySelector('.header');
      if (header) {
        await decorateBlock(header, 'header');
      }
      
      // 3. Load and decorate featured products block
      const featuredBlock = document.querySelector('[data-block-name="featured-products"]');
      if (featuredBlock) {
        await decorateBlock(featuredBlock, 'featured-products');
      }
      
      // 4. Initialize cart manager
      await import('./scripts/cart-manager.js');
    }
    
    // Start page initialization
    await initPage();
  </script>
</body>
</html>
