<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Load critical data synchronously to prevent layout shift -->
  <script>
    window.__INITIAL_CART_COUNT__ = (() => {
      try {
        const cart = JSON.parse(localStorage.getItem('buildright_cart') || '[]');
        return cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
      } catch (e) {
        return 0;
      }
    })();
    window.__INITIAL_LOCATION__ = localStorage.getItem('buildright_selected_location') || null;
  </script>
  <title>BuildRight Solutions - Building Materials Distributor</title>
  <script src="./scripts/scripts.js" type="module"></script>
  <link rel="stylesheet" href="./styles/styles.css">
  <link rel="stylesheet" href="./styles/blocks/hero-banner.css">
  <link rel="stylesheet" href="./styles/blocks/ideas-center.css">
  <link rel="stylesheet" href="./styles/blocks/shop-by-job.css">
  <!-- Critical CSS for active nav state and comprehensive CLS prevention -->
  <style>
    .nav-link.active, .nav-link[aria-current="page"] {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    /* Comprehensive CLS prevention - reserve space for all dynamic content */
    
    /* Location selector - prevent dropdown menu shift */
    .location-selector {
      min-height: 40px;
      min-width: 280px;
    }
    
    .location-menu {
      position: absolute;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    
    .location-menu.active {
      opacity: 1;
      visibility: visible;
    }
    
    
    /* Product grid */
    .products-container {
      min-height: 300px;
    }
    
    /* Prevent flash of unstyled content */
    [data-loading="true"] {
      opacity: 0.6;
      pointer-events: none;
    }
    
    /* Fragment FOUC prevention */
    body:not(.ready) {
      opacity: 0;
    }
    
    body.ready {
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
    }
  </style>
</head>
<body>
  <!-- Header loaded dynamically from blocks/header/ -->
  <header></header>

  <!-- Hero Section (Fragment Container) -->
  <div class="hero-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
      <div class="skeleton-text"></div>
    </div>
  </div>

  <!-- Features Section (Fragment Container) -->
  <div class="features-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
    </div>
  </div>

  <!-- CTA Section (Fragment Container) -->
  <div class="cta-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
    </div>
  </div>

  <!-- Featured Products - Main Content -->
  <main>
    <section class="section" style="padding: 4rem 0 5rem 0; background: var(--color-surface);">
      <div class="container">
        <div class="flex justify-between items-center mb-4">
          <h2 style="margin: 0; font-size: 1.75rem; font-weight: 700;">Featured Products</h2>
          <a href="catalog" style="color: var(--color-brand-500); text-decoration: none; font-weight: 600; font-size: var(--font-size-base);">View All Products →</a>
        </div>
        <div class="products-container featured-products" id="featured-products">
          <!-- Products will be loaded by JavaScript -->
        </div>
      </div>
    </section>

    <!-- Ideas Center -->
    <section class="section section-dark" style="padding: 4rem 0 5rem 0;">
      <div class="container">
        <h2 class="text-center mb-2 text-2xl">Ideas Center</h2>
        <p class="text-center mb-4 max-w-600 mx-auto" style="color: var(--color-text-light);">Expert tips, guides, and inspiration for your next project</p>
        <div class="grid grid-4 gap-6">
          <!-- Card 1: How-To Guide -->
          <div class="ideas-center__card">
            <div class="ideas-center__image" style="background-image: url('https://images.unsplash.com/photo-1513467535987-fd81bc7d62f8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
            <div class="ideas-center__content">
              <span class="badge badge-warning mb-4">How-To Guide</span>
              <h3 class="ideas-center__heading">Choosing the Right Grade</h3>
              <p class="ideas-center__text">Learn about different lumber grades and when to use each for optimal results.</p>
              <a href="#" class="ideas-center__link">Read More →</a>
            </div>
          </div>
          
          <!-- Card 2: Project Ideas -->
          <div class="ideas-center__card">
            <div class="ideas-center__image" style="background-image: url('https://images.unsplash.com/photo-1556912173-46c336c7fd55?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
            <div class="ideas-center__content">
              <span class="badge badge-primary mb-4">Project Ideas</span>
              <h3 class="ideas-center__heading">10 Kitchen Remodel Ideas</h3>
              <p class="ideas-center__text">Inspiration and material recommendations for your kitchen renovation.</p>
              <a href="#" class="ideas-center__link">Read More →</a>
            </div>
          </div>
          
          <!-- Card 3: Expert Tips -->
          <div class="ideas-center__card">
            <div class="ideas-center__image" style="background-image: url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
            <div class="ideas-center__content">
              <span class="badge badge-success mb-4">Expert Tips</span>
              <h3 class="ideas-center__heading">Pro Tips for Framing</h3>
              <p class="ideas-center__text">Professional framing techniques and best practices from experienced contractors.</p>
              <a href="#" class="ideas-center__link">Read More →</a>
            </div>
          </div>
          
          <!-- Card 4: Product Spotlight -->
          <div class="ideas-center__card">
            <div class="ideas-center__image" style="background-image: url('https://images.unsplash.com/photo-1581244277943-fe4a9c777189?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
            <div class="ideas-center__content">
              <span class="badge badge-secondary mb-4">Product Spotlight</span>
              <h3 class="ideas-center__heading">Best Fasteners for Outdoors</h3>
              <p class="ideas-center__text">Choosing the right fasteners for weather-resistant outdoor construction.</p>
              <a href="#" class="ideas-center__link">Read More →</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Featured Categories -->
    <section class="section" style="padding: 4rem 0 5rem 0; background: var(--color-surface);">
      <div class="container">
        <h2 class="text-center mb-2 text-2xl">Featured Categories</h2>
        <p class="text-center mb-4 max-w-600 mx-auto" style="color: var(--color-text-light);">Browse our most popular building material categories</p>
        <div class="grid grid-3 gap-6">
          <a href="catalog/structural-materials" class="card featured-category-card" style="text-decoration: none; color: inherit; text-align: center; padding: 2rem 1.5rem; transition: all 0.2s; border: 1px solid var(--color-border);" onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--color-primary)'; this.style.boxShadow='var(--shape-shadow-2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--color-border)'; this.style.boxShadow='none'">
            <div class="featured-category-icon">
              <img src="icons/categories/structural.svg" alt="Structural Materials" width="64" height="64">
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--color-text); font-size: 1.125rem; font-weight: 600;">Structural Materials</h3>
            <p style="color: var(--color-text-light); font-size: 0.875rem; margin: 0;">Lumber, studs, joists, beams</p>
          </a>
          <a href="catalog/windows-doors" class="card featured-category-card" style="text-decoration: none; color: inherit; text-align: center; padding: 2rem 1.5rem; transition: all 0.2s; border: 1px solid var(--color-border);" onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--color-primary)'; this.style.boxShadow='var(--shape-shadow-2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--color-border)'; this.style.boxShadow='none'">
            <div class="featured-category-icon">
              <img src="icons/categories/windows-doors.svg" alt="Windows & Doors" width="64" height="64">
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--color-text); font-size: 1.125rem; font-weight: 600;">Windows & Doors</h3>
            <p style="color: var(--color-text-light); font-size: 0.875rem; margin: 0;">Residential and commercial</p>
          </a>
          <a href="catalog/fasteners-hardware" class="card featured-category-card" style="text-decoration: none; color: inherit; text-align: center; padding: 2rem 1.5rem; transition: all 0.2s; border: 1px solid var(--color-border);" onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--color-primary)'; this.style.boxShadow='var(--shape-shadow-2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--color-border)'; this.style.boxShadow='none'">
            <div class="featured-category-icon">
              <img src="icons/categories/fasteners.svg" alt="Fasteners & Hardware" width="64" height="64">
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--color-text); font-size: 1.125rem; font-weight: 600;">Fasteners & Hardware</h3>
            <p style="color: var(--color-text-light); font-size: 0.875rem; margin: 0;">Nails, screws, brackets</p>
          </a>
          <a href="catalog/roofing" class="card featured-category-card" style="text-decoration: none; color: inherit; text-align: center; padding: 2rem 1.5rem; transition: all 0.2s; border: 1px solid var(--color-border);" onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--color-primary)'; this.style.boxShadow='var(--shape-shadow-2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--color-border)'; this.style.boxShadow='none'">
            <div class="featured-category-icon">
              <img src="icons/categories/roofing.svg" alt="Roofing Materials" width="64" height="64">
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--color-text); font-size: 1.125rem; font-weight: 600;">Roofing Materials</h3>
            <p style="color: var(--color-text-light); font-size: 0.875rem; margin: 0;">Shingles, underlayment, flashing</p>
          </a>
          <a href="catalog/framing-drywall" class="card featured-category-card" style="text-decoration: none; color: inherit; text-align: center; padding: 2rem 1.5rem; transition: all 0.2s; border: 1px solid var(--color-border);" onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--color-primary)'; this.style.boxShadow='var(--shape-shadow-2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--color-border)'; this.style.boxShadow='none'">
            <div class="featured-category-icon">
              <img src="icons/categories/framing-drywall.svg" alt="Framing & Drywall" width="64" height="64">
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--color-text); font-size: 1.125rem; font-weight: 600;">Framing & Drywall</h3>
            <p style="color: var(--color-text-light); font-size: 0.875rem; margin: 0;">Panels, tape, compound</p>
          </a>
          <a href="catalog" class="card featured-category-card" style="text-decoration: none; color: inherit; text-align: center; padding: 2rem 1.5rem; transition: all 0.2s; border: 1px solid var(--color-border);" onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--color-primary)'; this.style.boxShadow='var(--shape-shadow-2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--color-border)'; this.style.boxShadow='none'">
            <div class="featured-category-icon">
              <img src="icons/categories/catalog.svg" alt="View All Products" width="64" height="64">
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--color-text); font-size: 1.125rem; font-weight: 600;">View All Products</h3>
            <p style="color: var(--color-text-light); font-size: 0.875rem; margin: 0;">Browse complete catalog</p>
          </a>
        </div>
      </div>
    </section>

    <!-- Shop By Job -->
    <section class="section" style="padding: 4rem 0 5rem 0;">
      <div class="container">
        <h2 class="text-center mb-2 text-2xl">Shop By Job</h2>
        <p class="text-center mb-4 max-w-600 mx-auto" style="color: var(--color-text-light);">Get a customized material kit for your specific construction job</p>
        <div class="grid grid-3 gap-6">
          <a href="pages/project-builder.html?projectType=new_construction&projectDetail=residential_home&complexity=moderate" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Frame a Wall</h3>
              <p class="shop-by-job__text">Complete framing materials for residential wall construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?projectType=remodel&projectDetail=bathroom&complexity=moderate" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Remodel a Bathroom</h3>
              <p class="shop-by-job__text">Materials for bathroom renovation and remodeling projects</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?projectType=remodel&projectDetail=exterior&complexity=basic" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1509644851169-2acc08aa25b5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Install Windows</h3>
              <p class="shop-by-job__text">Window installation materials and hardware</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?projectType=new_construction&projectDetail=residential_home&complexity=complex" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1518736346281-76873166a64a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Roof a House</h3>
              <p class="shop-by-job__text">Complete roofing materials for new construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?projectType=repair&projectDetail=plumbing&complexity=basic" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1607472586893-edb57bdc0e39?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Repair Plumbing</h3>
              <p class="shop-by-job__text">Essential materials for plumbing repairs and maintenance</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?projectType=new_construction&projectDetail=outdoor&complexity=moderate" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1656646549607-8fda5837a4ca?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Build a Deck</h3>
              <p class="shop-by-job__text">Lumber, fasteners, and materials for outdoor deck construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer (Fragment Container) -->
  <div class="footer-fragment"></div>

  <script type="module">
    // Import personalization system
    import { personalizeHomepage } from './scripts/personalize-page.js';
    
    // Personalize page on load
    await personalizeHomepage();
    
    // Load featured products - simplified for EDS data format
    async function loadFeaturedProducts() {
      try {
        const basePath = window.BASE_PATH || '/';
        const response = await fetch(`${basePath}data/mock-products.json`);
        if (!response.ok) {
          console.error('Failed to load products');
          return;
        }
        
        const products = await response.json();
        if (!products || products.length === 0) {
          console.warn('No products loaded');
          return;
        }
        
        const featured = products.slice(0, 4);
        const container = document.getElementById('featured-products');
        
        if (!container) {
          console.warn('Featured products container not found');
          return;
        }
        
        container.innerHTML = '';
        
        for (const product of featured) {
          const price = product.price || 0;
          const imageUrl = product.image || '';
          
          const card = document.createElement('a');
          card.className = 'product-card';
          card.href = `/pages/product-detail.html?sku=${product.sku}`;
          
          // Product image with background
          const image = document.createElement('div');
          image.className = 'product-card-image';
          
          // Only set background image if we have a valid image URL
          if (imageUrl && imageUrl.trim() !== '') {
            image.style.backgroundImage = `url('${imageUrl}')`;
            image.style.backgroundSize = 'cover';
            image.style.backgroundPosition = 'center';
            image.style.backgroundRepeat = 'no-repeat';
          } else {
            // Add placeholder class if no image
            image.classList.add('product-card-image-placeholder');
          }
          card.appendChild(image);
          
          // Header
          const header = document.createElement('div');
          header.className = 'product-card-header';
          const sku = document.createElement('div');
          sku.className = 'product-card-sku';
          sku.textContent = product.sku;
          header.appendChild(sku);
          const name = document.createElement('div');
          name.className = 'product-card-name';
          name.textContent = product.name;
          header.appendChild(name);
          card.appendChild(header);
          
          // Body
          const body = document.createElement('div');
          body.className = 'product-card-body';
          const description = document.createElement('div');
          description.className = 'product-card-description';
          description.textContent = product.description || 'Quality building materials';
          body.appendChild(description);
          card.appendChild(body);
          
          // Footer
          const footer = document.createElement('div');
          footer.className = 'product-card-footer';
          
          const pricing = document.createElement('div');
          pricing.className = 'product-card-pricing';
          const priceEl = document.createElement('span');
          priceEl.className = 'product-card-price';
          priceEl.textContent = `$${price.toFixed(2)}`;
          pricing.appendChild(priceEl);
          const priceLabel = document.createElement('span');
          priceLabel.className = 'product-card-price-label';
          priceLabel.textContent = 'per unit';
          pricing.appendChild(priceLabel);
          footer.appendChild(pricing);
          
          const actions = document.createElement('div');
          actions.className = 'product-card-actions';
          const addBtn = document.createElement('button');
          addBtn.className = 'btn btn-primary btn-sm';
          addBtn.textContent = 'View Details';
          addBtn.onclick = (e) => {
            e.preventDefault();
            e.stopPropagation();
            window.location.href = card.href;
          };
          actions.appendChild(addBtn);
          footer.appendChild(actions);
          
          card.appendChild(footer);
          container.appendChild(card);
        }
      } catch (error) {
        console.error('Error loading featured products:', error);
      }
    }
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadFeaturedProducts);
    } else {
      loadFeaturedProducts();
    }
  </script>
</body>
</html>
