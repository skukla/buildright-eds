<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Load critical data synchronously to prevent layout shift -->
  <script>
    // Set BASE_PATH immediately for GitHub Pages compatibility
    (function() {
      const pathname = window.location.pathname;
      const isGitHubPages = pathname.startsWith('/buildright-eds/');
      window.BASE_PATH = isGitHubPages ? '/buildright-eds/' : '/';
    })();
    
    window.__INITIAL_CART_COUNT__ = (() => {
      try {
        const cart = JSON.parse(localStorage.getItem('buildright_cart') || '[]');
        return cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
      } catch (e) {
        return 0;
      }
    })();
    window.__INITIAL_LOCATION__ = localStorage.getItem('buildright_selected_location') || null;
  </script>
  <title>BuildRight Solutions - Building Materials Distributor</title>
  <!-- Note: scripts.js NOT loaded here - this page uses personalization system instead -->
  <link rel="stylesheet" href="./styles/styles.css">
  <!-- Critical CSS for inlined header -->
  <link rel="stylesheet" href="./blocks/header/header.css">
  <link rel="stylesheet" href="./blocks/mini-cart/mini-cart.css">
  <link rel="stylesheet" href="./blocks/user-menu/user-menu.css">
  <link rel="stylesheet" href="./styles/blocks/hero-banner.css">
  <link rel="stylesheet" href="./styles/blocks/ideas-center.css">
  <link rel="stylesheet" href="./styles/blocks/shop-by-job.css">
  <!-- Critical CSS for active nav state and comprehensive CLS prevention -->
  <style>
    .nav-link.active, .nav-link[aria-current="page"] {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    /* Comprehensive CLS prevention - reserve space for all dynamic content */
    
    /* Location selector - prevent dropdown menu shift */
    .location-selector {
      min-height: 40px;
      min-width: 280px;
    }
    
    .location-menu {
      position: absolute;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    
    .location-menu.active {
      opacity: 1;
      visibility: visible;
    }
    
    
    /* Product grid */
    .products-container {
      min-height: 300px;
    }
    
    /* Prevent flash of unstyled content */
    [data-loading="true"] {
      opacity: 0.6;
      pointer-events: none;
    }
    
    /* Fragment FOUC prevention */
    body:not(.ready) {
      opacity: 0;
    }
    
    body.ready {
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
    }
    
    /* Note: Header CLS prevention now in styles/base.css */
  </style>
</head>
<body>
  <!-- Header loaded dynamically from blocks/header/ -->
  <header></header>

  <!-- Hero Section (Fragment Container) -->
  <div class="hero-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
      <div class="skeleton-text"></div>
    </div>
  </div>

  <!-- Features Section (Fragment Container) -->
  <div class="features-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
    </div>
  </div>

  <!-- Featured Products - Main Content -->
  <main>
    <section class="section" style="padding: 4rem 0; background: var(--color-background);">
      <div class="container">
        <h2 class="text-center mb-2" style="font-size: 1.75rem; font-weight: 700;">Featured Products</h2>
        <p class="text-center mb-4" style="color: var(--color-text-secondary); max-width: 600px; margin-left: auto; margin-right: auto; margin-bottom: 2rem;">Explore our most popular building materials and supplies</p>
        
        <!-- Featured Products Block -->
        <div class="featured-products" data-block-name="featured-products" data-block-status="loading">
          <div>
            <div>
              <div class="products-container featured-products">
                <!-- Products will be loaded by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  <!-- CTA Section (Fragment Container) -->
  <div class="cta-container">
    <!-- Loading skeleton -->
    <div class="skeleton-loader">
      <div class="skeleton-text"></div>
    </div>
  </div>

    <!-- Featured Categories (Unauthenticated Users Only) -->
    <section class="section unauthenticated-only" style="padding: 4rem 0; background: var(--color-surface);">
      <div class="container">
        <h2 class="text-center mb-4" style="font-size: 1.75rem; font-weight: 700;">Featured Categories</h2>
        <div class="grid grid-3 gap-6">
          <a href="catalog/structural-materials" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/structural.svg" alt="Structural Materials" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Structural Materials</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Lumber, studs, joists, beams</p>
          </a>
          <a href="catalog/windows-doors" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/windows-doors.svg" alt="Windows & Doors" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Windows & Doors</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Residential and commercial</p>
          </a>
          <a href="catalog/fasteners-hardware" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/fasteners.svg" alt="Fasteners & Hardware" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Fasteners & Hardware</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Nails, screws, brackets</p>
          </a>
          <a href="catalog/roofing" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/roofing.svg" alt="Roofing Materials" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Roofing Materials</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Shingles, underlayment, flashing</p>
          </a>
          <a href="catalog/framing-drywall" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/framing-drywall.svg" alt="Framing & Drywall" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">Framing & Drywall</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Panels, tape, compound</p>
          </a>
          <a href="catalog" class="card featured-category-card">
            <div class="featured-category-icon">
              <img src="icons/categories/catalog.svg" alt="View All Products" width="64" height="64">
            </div>
            <h3 class="mb-2" style="font-size: 1.125rem; font-weight: 600;">View All Products</h3>
            <p class="text-light" style="font-size: 0.875rem; margin: 0;">Browse complete catalog</p>
          </a>
        </div>
      </div>
    </section>

    <!-- Shop By Job (Unauthenticated Users Only) -->
    <section class="section unauthenticated-only" style="padding: 4rem 0; background: var(--color-background);">
      <div class="container">
        <h2 class="text-center mb-4" style="font-size: 1.75rem; font-weight: 700;">Shop By Job</h2>
        <p class="text-center mb-4" style="color: var(--color-text-light); max-width: 600px; margin-left: auto; margin-right: auto;">Get a customized material kit for your specific construction job</p>
        <div class="grid grid-3 gap-6">
          <a href="pages/project-builder.html?type=framing" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Frame a Wall</h3>
              <p class="shop-by-job__text">Complete framing materials for residential wall construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=bathroom" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Remodel a Bathroom</h3>
              <p class="shop-by-job__text">Materials for bathroom renovation and remodeling projects</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=windows" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1509644851169-2acc08aa25b5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Install Windows</h3>
              <p class="shop-by-job__text">Window installation materials and hardware</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=roofing" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1518736346281-76873166a64a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Roof a House</h3>
              <p class="shop-by-job__text">Complete roofing materials for new construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=plumbing" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1607472586893-edb57bdc0e39?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Repair Plumbing</h3>
              <p class="shop-by-job__text">Essential materials for plumbing repairs and maintenance</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
          
          <a href="pages/project-builder.html?type=deck" class="shop-by-job__card" style="background-image: url('https://images.unsplash.com/photo-1656646549607-8fda5837a4ca?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');">
            <div class="shop-by-job__overlay"></div>
            <div class="shop-by-job__content">
              <h3 class="shop-by-job__heading">Build a Deck</h3>
              <p class="shop-by-job__text">Lumber, fasteners, and materials for outdoor deck construction</p>
              <span class="shop-by-job__cta">Start Project →</span>
            </div>
          </a>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer (Fragment Container) -->
  <div class="footer-fragment"></div>

  <script type="module">
    // Import required modules
    import { personalizeHomepage } from './scripts/personalize-page.js';
    import { decorateBlock } from './scripts/scripts.js';
    
    // Initialize the page
    async function initPage() {
      // 1. Personalize page with fragments
      await personalizeHomepage();
      
      // 2. Initialize header interactivity
      const header = document.querySelector('.header');
      if (header) {
        await decorateBlock(header, 'header');
      }
      
      // 3. Load and decorate featured products block
      const featuredBlock = document.querySelector('[data-block-name="featured-products"]');
      if (featuredBlock) {
        await decorateBlock(featuredBlock, 'featured-products');
      }
      
      // 4. Initialize cart manager
      await import('./scripts/cart-manager.js');
    }
    
    // Start page initialization
    await initPage();
  </script>
</body>
</html>
